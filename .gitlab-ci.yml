variables:
  GIT_SUBMODULE_STRATEGY: normal
  DOCKER_IMAGE: $CI_REGISTRY/a16bitsysop/dovecot-xapian:test

include:
- template: Jobs/Code-Quality.gitlab-ci.yml
- template: Jobs/Build.gitlab-ci.yml
- template: Jobs/Secret-Detection.gitlab-ci.yml
- template: Security/SAST.gitlab-ci.yml
- template: Security/Container-Scanning.gitlab-ci.yml
- local: /templates/docker-buildx.yml
stages:
- build
- test
- build_x_push

before_script:
  - git submodule update --init --recursive templates
# add after_script to build to get label info
build:
  variables:
    CI_COMMIT_TAG: test
  after_script:
    - ./container-scripts/get-label-info.sh
  artifacts:
    reports:
      dotenv: build.env
